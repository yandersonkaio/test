/*

<div class="Akuo4">
	<div class="_1Flk2 _2DPZK" style="min-width: 400px">
		<span class="_2zn9Y"></span></div>
	<div class="_1Flk2 _1sFTb" style="min-width: 500xpx">
		<span class="_2zn9Y"></span></div>
	<div class="_1Flk2 _3xysY" style="max-width: 391px">
		<span class="_2zn9Y"></span></div>
</div>

*/

const _  = (a, b) => {
	if (!b) {
		b = a;
		a = wtm.document;
	}
	return a ? a.querySelector(b): null;
};

async function getContacts() {
	try {
		const res = await fetch(`https://${config.cluster}/wsvc/getcontacts.php?vd_number=${config.params.get('phone_number')}&vd_key=${config.params.get('vd_key')}`);
		return await res.json();
	} catch(err) {
		console.log(err);
		console.log('Não foi possivel consultar os contatos no portal');
	}
}

const htmlActivationForm =
`<style>
	.wtm_wsp {
		text-align: center;
		user-select: auto;
		display: inline-block;
		width: 100%;
		height: 100%;
		background-color: #1ebea5;
	}

	.wtm_wsp input::selection {
		background: #ccf !important;
	}

	.logo{
		width: 100%;
		height: 60px;
		background-color: #fff;
		background-image: url("data:image/svg+xml,%3Csvg version='1.1' id='Layer_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='7.935 2.125 750 105.548' style='enable-background:new 7.935 2.125 750 105.548;' xml:space='preserve'%3E%3Cstyle type='text/css'%3E .st0%7Bfill:%2343A147;%7D .st1%7Bfill:%23274E66;%7D .st2%7Benable-background:new ;%7D%0A%3C/style%3E%3Cg%3E%3Cg%3E%3Cpolygon class='st0' points='53.607,33.582 53.421,82.442 75.801,62.114 75.903,33.582 '/%3E%3C/g%3E%3Cg%3E%3Cg%3E%3Cpath class='st1' d='M117.013,56.229c-3.868,9.194-10.572,18.379-19.753,26.165c-22.814,19.354-52.234,22.708-65.711,7.499 c-13.477-15.212-5.907-43.228,16.909-62.578c22.814-19.351,52.236-22.705,65.713-7.497c2.534,2.861,4.324,6.175,5.409,9.799 h7.288c-1.232-5.319-3.624-10.194-7.279-14.317C103.579-2.768,69.694,0.313,43.91,22.181 c-25.786,21.87-33.709,54.246-17.7,72.318c16.011,18.065,49.896,14.988,75.679-6.884c13.547-11.487,22.156-25.879,24.962-39.571 L117.013,56.229z'/%3E%3C/g%3E%3Cpath class='st0' d='M78.957,78.412c0.042-7.229,0.077-14.439,0.11-21.647c0.032-7.069,0.065-14.134,0.107-21.199l0.011-1.985 h57.593L78.934,82.766L78.957,78.412z'/%3E%3Cg class='st2'%3E%3Cpath class='st1' d='M145.442,35.245c0.494-0.09,1.111-0.157,1.852-0.203c0.742-0.043,1.427-0.068,2.056-0.068 c0.629,0,1.27,0.024,1.921,0.068c0.653,0.045,1.249,0.113,1.787,0.203l8.293,40.375l9.977-40.375 c0.541-0.09,1.136-0.157,1.786-0.203c0.653-0.043,1.27-0.068,1.855-0.068c0.537,0,1.143,0.024,1.818,0.068 c0.678,0.045,1.258,0.113,1.756,0.203l10.044,40.783l8.426-40.783c0.495-0.09,1.022-0.157,1.583-0.203 c0.56-0.043,1.113-0.068,1.654-0.068c0.627,0,1.269,0.024,1.918,0.068c0.652,0.045,1.226,0.113,1.721,0.203l-11.662,48.466 c-0.539,0.091-1.168,0.158-1.887,0.204c-0.724,0.042-1.371,0.066-1.953,0.066c-0.631,0-1.327-0.024-2.091-0.066 c-0.765-0.044-1.462-0.114-2.091-0.204l-9.574-37.95l-9.707,37.95c-0.629,0.091-1.313,0.158-2.056,0.204 c-0.744,0.042-1.427,0.066-2.056,0.066c-0.541,0-1.157-0.024-1.854-0.066c-0.694-0.044-1.312-0.114-1.853-0.204L145.442,35.245z' /%3E%3Cpath class='st1' d='M213.119,54.388h-4.38c-0.091-0.359-0.16-0.775-0.204-1.244c-0.043-0.473-0.067-0.931-0.067-1.385 c0-0.448,0.022-0.909,0.067-1.382c0.045-0.473,0.112-0.888,0.204-1.246h10.921v34.579c-0.496,0.091-1.046,0.158-1.651,0.204 c-0.609,0.042-1.158,0.066-1.651,0.066c-0.449,0-0.977-0.024-1.585-0.066c-0.609-0.044-1.157-0.114-1.651-0.204V54.388H213.119z M211.638,41.513c-0.094-0.541-0.147-1.125-0.17-1.754c-0.024-0.629-0.035-1.191-0.035-1.686c0-0.493,0.011-1.057,0.035-1.685 c0.023-0.629,0.076-1.19,0.17-1.687c0.586-0.09,1.212-0.157,1.89-0.203c0.673-0.043,1.257-0.068,1.754-0.068 c0.492,0,1.076,0.024,1.752,0.068c0.675,0.044,1.282,0.113,1.821,0.203c0.089,0.498,0.145,1.057,0.17,1.687 c0.022,0.628,0.032,1.192,0.032,1.685c0,0.495-0.011,1.057-0.032,1.686c-0.023,0.629-0.081,1.212-0.17,1.754 c-0.538,0.09-1.136,0.157-1.787,0.201c-0.653,0.046-1.226,0.064-1.72,0.064c-0.539,0-1.145-0.019-1.821-0.064 C212.847,41.67,212.221,41.605,211.638,41.513z'/%3E%3Cpath class='st1' d='M230.51,49.131c0.496-0.089,0.979-0.16,1.448-0.203c0.473-0.045,0.957-0.067,1.452-0.067 c0.493,0,0.952,0.022,1.38,0.067c0.427,0.043,0.886,0.114,1.383,0.203c0.137,0.675,0.27,1.582,0.402,2.729 c0.135,1.146,0.202,2.104,0.202,2.862c0.45-0.762,1.024-1.528,1.72-2.29c0.696-0.765,1.491-1.452,2.392-2.057 c0.898-0.605,1.934-1.101,3.103-1.483c1.169-0.381,2.448-0.573,3.842-0.573c3.955,0,6.874,1.135,8.764,3.404 c1.89,2.268,2.83,5.628,2.83,10.075v21.912c-0.494,0.091-1.055,0.158-1.685,0.204c-0.627,0.042-1.191,0.066-1.686,0.066 c-0.494,0-1.044-0.024-1.653-0.066c-0.605-0.044-1.156-0.114-1.651-0.204V63.624c0-3.189-0.496-5.54-1.481-7.043 c-0.99-1.505-2.563-2.259-4.721-2.259c-1.257,0-2.448,0.226-3.573,0.677c-1.122,0.447-2.11,1.143-2.966,2.088 c-0.855,0.942-1.539,2.171-2.056,3.676c-0.516,1.505-0.776,3.313-0.776,5.422v17.526c-0.495,0.094-1.042,0.161-1.651,0.207 c-0.606,0.039-1.157,0.066-1.653,0.066c-0.495,0-1.058-0.027-1.686-0.066c-0.629-0.045-1.192-0.112-1.686-0.207L230.51,49.131 L230.51,49.131z'/%3E%3Cpath class='st1' d='M292.528,77.712c0.358,0.627,0.674,1.41,0.942,2.359c0.27,0.942,0.426,1.909,0.472,2.897 c-2.652,1.036-5.686,1.551-9.102,1.551c-5.753,0-10.089-1.624-13.008-4.884c-2.924-3.26-4.38-7.652-4.38-13.18 c0-2.565,0.36-4.943,1.077-7.144c0.719-2.201,1.786-4.114,3.203-5.731c1.413-1.618,3.18-2.898,5.288-3.841 c2.115-0.942,4.563-1.414,7.348-1.414c1.887,0,3.55,0.114,4.987,0.337c1.441,0.223,2.809,0.585,4.111,1.078 c0,0.766-0.103,1.652-0.303,2.661c-0.199,1.012-0.483,1.9-0.842,2.667c-2.205-0.767-4.719-1.149-7.552-1.149 c-3.461,0-6.043,1.149-7.754,3.441c-1.707,2.293-2.559,5.326-2.559,9.099c0,4.31,0.965,7.469,2.896,9.473 c1.934,1.997,4.585,2.998,7.956,2.998c1.347,0,2.595-0.088,3.74-0.268C290.2,78.481,291.358,78.161,292.528,77.712z'/%3E%3Cpath class='st1' d='M314.704,84.521c-2.696,0-5.054-0.46-7.075-1.381c-2.023-0.924-3.707-2.192-5.057-3.809 c-1.349-1.618-2.348-3.527-2.999-5.73c-0.654-2.201-0.98-4.583-0.98-7.144c0-2.558,0.325-4.943,0.98-7.144 c0.651-2.201,1.649-4.114,2.999-5.731c1.344-1.618,3.033-2.898,5.057-3.841c2.024-0.941,4.38-1.414,7.075-1.414 c2.698,0,5.057,0.474,7.076,1.414c2.024,0.943,3.706,2.225,5.057,3.841c1.348,1.618,2.35,3.53,3,5.731 c0.655,2.201,0.981,4.586,0.981,7.144c0,2.561-0.327,4.943-0.981,7.144c-0.65,2.202-1.651,4.111-3,5.73 c-1.348,1.617-3.033,2.887-5.057,3.809C319.761,84.057,317.4,84.521,314.704,84.521z M314.704,79.195 c3.101,0,5.394-1.122,6.879-3.37c1.483-2.246,2.222-5.369,2.222-9.366c0-3.999-0.739-7.111-2.222-9.337 c-1.485-2.226-3.78-3.341-6.879-3.341c-3.099,0-5.382,1.115-6.841,3.341c-1.463,2.228-2.19,5.338-2.19,9.337 c0,3.998,0.727,7.121,2.19,9.366C309.321,78.071,311.602,79.195,314.704,79.195z'/%3E%3Cpath class='st1' d='M364.454,41.243h-12.608c-0.091-0.448-0.157-0.943-0.203-1.483c-0.046-0.536-0.068-1.056-0.068-1.549 c0-0.495,0.022-1,0.068-1.515c0.045-0.517,0.111-1.001,0.203-1.451h32.087c0.092,0.448,0.16,0.922,0.204,1.415 c0.043,0.495,0.068,0.99,0.068,1.483c0,0.496-0.024,1.021-0.068,1.583c-0.043,0.564-0.111,1.068-0.204,1.518h-12.602v42.467 c-1.037,0.134-2.161,0.204-3.372,0.204c-1.259,0-2.425-0.07-3.503-0.204L364.454,41.243L364.454,41.243z'/%3E%3Cpath class='st1' d='M404.559,60.929c0-2.653-0.672-4.496-2.023-5.531c-1.344-1.033-3.301-1.549-5.866-1.549 c-1.571,0-3.044,0.122-4.415,0.371c-1.368,0.249-2.707,0.574-4.011,0.978c-0.859-1.484-1.28-3.257-1.28-5.328 c1.528-0.493,3.211-0.875,5.058-1.146c1.844-0.268,3.617-0.402,5.327-0.402c4.493,0,7.905,1.023,10.243,3.068 c2.335,2.044,3.507,5.313,3.507,9.809v21.639c-1.577,0.36-3.484,0.726-5.731,1.111c-2.248,0.383-4.539,0.574-6.876,0.574 c-2.203,0-4.189-0.204-5.966-0.607c-1.774-0.401-3.278-1.056-4.514-1.953c-1.24-0.899-2.189-2.047-2.867-3.441 c-0.672-1.391-1.007-3.071-1.007-5.054c0-1.933,0.39-3.625,1.18-5.088c0.787-1.46,1.854-2.674,3.201-3.64 c1.348-0.968,2.9-1.689,4.654-2.162c1.755-0.471,3.596-0.708,5.529-0.708c1.436,0,2.617,0.036,3.54,0.107 c0.923,0.063,1.695,0.145,2.323,0.236v-1.28h-0.007v-0.003H404.559z M404.559,67.465c-0.672-0.089-1.528-0.18-2.561-0.268 c-1.034-0.091-1.909-0.137-2.631-0.137c-2.785,0-4.911,0.518-6.369,1.554c-1.46,1.033-2.189,2.607-2.189,4.72 c0,1.345,0.243,2.405,0.739,3.168c0.491,0.768,1.113,1.345,1.857,1.759c0.74,0.403,1.558,0.647,2.457,0.738 c0.899,0.092,1.755,0.135,2.561,0.135c1.036,0,2.103-0.055,3.204-0.17c1.103-0.109,2.079-0.283,2.929-0.505L404.559,67.465 L404.559,67.465z'/%3E%3Cpath class='st1' d='M421.009,34.3c0.498-0.089,1.044-0.158,1.651-0.2c0.607-0.047,1.156-0.07,1.651-0.07 c0.493,0,1.044,0.024,1.651,0.07c0.603,0.042,1.155,0.111,1.65,0.2v38.964c0,1.259,0.111,2.246,0.337,2.965 c0.22,0.721,0.524,1.267,0.911,1.65c0.381,0.383,0.831,0.629,1.346,0.744c0.515,0.109,1.066,0.17,1.65,0.17 c0.403,0,0.866-0.026,1.383-0.069c0.516-0.044,0.952-0.106,1.315-0.203c0.406,1.575,0.603,3.281,0.603,5.121 c-0.627,0.229-1.391,0.375-2.292,0.443c-0.898,0.068-1.728,0.102-2.492,0.102c-1.305,0-2.519-0.155-3.64-0.472 c-1.128-0.312-2.113-0.829-2.966-1.552c-0.857-0.718-1.526-1.685-2.024-2.897c-0.498-1.211-0.741-2.717-0.741-4.517L421.009,34.3 L421.009,34.3z'/%3E%3Cpath class='st1' d='M440.957,34.3c0.498-0.089,1.047-0.158,1.651-0.2c0.609-0.047,1.159-0.07,1.651-0.07 c0.495,0,1.06,0.024,1.692,0.07c0.626,0.042,1.188,0.111,1.683,0.2v49.41c-0.495,0.091-1.056,0.158-1.683,0.204 c-0.63,0.042-1.194,0.066-1.692,0.066c-0.493,0-1.043-0.024-1.651-0.066c-0.604-0.044-1.155-0.114-1.651-0.204V34.3z M449.455,65.779l10.989-16.651c0.583-0.089,1.167-0.158,1.752-0.203c0.586-0.045,1.194-0.065,1.823-0.065 c0.673,0,1.316,0.02,1.921,0.065c0.604,0.045,1.22,0.114,1.851,0.203l-10.985,16.177l12.872,18.398 c-0.629,0.094-1.237,0.162-1.823,0.207c-0.583,0.04-1.192,0.066-1.818,0.066c-0.63,0-1.26-0.026-1.887-0.066 c-0.636-0.043-1.263-0.112-1.89-0.207L449.455,65.779z'/%3E%3Cpath class='st1' d='M493.744,35.245c0.536-0.09,1.154-0.157,1.851-0.203c0.696-0.043,1.355-0.068,1.991-0.068 c0.626,0,1.316,0.024,2.053,0.068c0.744,0.045,1.359,0.113,1.853,0.203l12.54,30.333l12.608-30.333 c0.447-0.09,1.008-0.157,1.682-0.203c0.678-0.043,1.325-0.068,1.961-0.068c0.583,0,1.236,0.024,1.956,0.068 c0.715,0.045,1.322,0.113,1.817,0.203l2.296,48.466c-0.539,0.091-1.093,0.158-1.651,0.204c-0.564,0.042-1.141,0.066-1.719,0.066 c-0.588,0-1.159-0.024-1.722-0.066c-0.561-0.044-1.089-0.114-1.58-0.204l-1.555-37.682l-11.868,27.638 c-0.899,0.134-1.82,0.201-2.765,0.201c-0.853,0-1.706-0.068-2.561-0.201l-11.461-27.838l-1.551,37.882 c-0.495,0.091-1.006,0.16-1.549,0.207c-0.541,0.039-1.056,0.066-1.552,0.066c-0.584,0-1.142-0.027-1.685-0.066 c-0.539-0.046-1.056-0.115-1.552-0.207L493.744,35.245z'/%3E%3Cpath class='st1' d='M565.127,60.929c0-2.653-0.67-4.496-2.02-5.531c-1.346-1.033-3.303-1.549-5.866-1.549 c-1.572,0-3.047,0.122-4.415,0.371c-1.371,0.249-2.712,0.574-4.014,0.978c-0.857-1.484-1.279-3.257-1.279-5.328 c1.528-0.493,3.209-0.875,5.054-1.146c1.847-0.268,3.621-0.402,5.331-0.402c4.494,0,7.905,1.023,10.242,3.068 c2.336,2.044,3.506,5.313,3.506,9.809v21.639c-1.574,0.36-3.484,0.726-5.73,1.111c-2.249,0.383-4.54,0.574-6.876,0.574 c-2.201,0-4.192-0.204-5.969-0.607c-1.774-0.401-3.28-1.056-4.514-1.953c-1.236-0.899-2.191-2.047-2.866-3.441 c-0.67-1.391-1.006-3.071-1.006-5.054c0-1.933,0.393-3.625,1.181-5.088c0.784-1.46,1.852-2.674,3.199-3.64 c1.348-0.968,2.897-1.689,4.654-2.162c1.754-0.471,3.596-0.708,5.527-0.708c1.437,0,2.617,0.036,3.54,0.107 c0.924,0.063,1.696,0.145,2.325,0.236v-1.28h-0.009v-0.003H565.127z M565.127,67.465c-0.67-0.089-1.525-0.18-2.556-0.268 c-1.039-0.091-1.912-0.137-2.634-0.137c-2.785,0-4.914,0.518-6.37,1.554c-1.46,1.033-2.188,2.607-2.188,4.72 c0,1.345,0.242,2.405,0.738,3.168c0.492,0.768,1.114,1.345,1.857,1.759c0.739,0.403,1.561,0.647,2.458,0.738 c0.901,0.092,1.754,0.135,2.562,0.135c1.033,0,2.099-0.055,3.201-0.17c1.102-0.109,2.082-0.283,2.932-0.505V67.465 L565.127,67.465z'/%3E%3Cpath class='st1' d='M581.711,49.131c0.498-0.089,0.98-0.16,1.449-0.203c0.472-0.045,0.954-0.067,1.454-0.067 c0.493,0,0.949,0.022,1.384,0.067c0.424,0.043,0.88,0.114,1.381,0.203c0.13,0.675,0.266,1.582,0.4,2.729 c0.132,1.146,0.203,2.104,0.203,2.862c0.447-0.762,1.023-1.528,1.719-2.29c0.695-0.765,1.495-1.452,2.392-2.057 c0.899-0.605,1.932-1.101,3.103-1.483c1.165-0.381,2.445-0.573,3.841-0.573c3.955,0,6.872,1.135,8.762,3.404 c1.889,2.268,2.833,5.628,2.833,10.075v21.912c-0.495,0.091-1.059,0.158-1.689,0.204c-0.627,0.042-1.191,0.066-1.686,0.066 c-0.495,0-1.044-0.024-1.651-0.066c-0.609-0.044-1.157-0.114-1.653-0.204V63.624c0-3.189-0.495-5.54-1.482-7.043 c-0.99-1.505-2.562-2.259-4.72-2.259c-1.262,0-2.446,0.226-3.573,0.677c-1.124,0.447-2.11,1.143-2.966,2.088 c-0.855,0.947-1.538,2.171-2.057,3.676c-0.515,1.503-0.777,3.313-0.777,5.422v17.526c-0.493,0.094-1.043,0.161-1.649,0.207 c-0.604,0.039-1.161,0.066-1.65,0.066c-0.496,0-1.057-0.027-1.686-0.066c-0.632-0.045-1.193-0.112-1.69-0.207V49.131H581.711z'/%3E%3Cpath class='st1' d='M638.94,60.929c0-2.653-0.67-4.496-2.021-5.531c-1.349-1.033-3.304-1.549-5.866-1.549 c-1.572,0-3.045,0.122-4.416,0.371c-1.37,0.249-2.706,0.574-4.011,0.978c-0.859-1.484-1.282-3.257-1.282-5.328 c1.529-0.493,3.214-0.875,5.059-1.146c1.84-0.268,3.617-0.402,5.327-0.402c4.495,0,7.905,1.023,10.241,3.068 c2.335,2.044,3.509,5.313,3.509,9.809v21.639c-1.578,0.36-3.483,0.726-5.733,1.111c-2.25,0.383-4.537,0.574-6.876,0.574 c-2.201,0-4.188-0.204-5.964-0.607c-1.776-0.401-3.281-1.056-4.516-1.953c-1.237-0.899-2.189-2.047-2.863-3.441 c-0.675-1.391-1.01-3.071-1.01-5.054c0-1.933,0.391-3.625,1.18-5.088c0.788-1.46,1.853-2.674,3.201-3.64 c1.348-0.968,2.9-1.689,4.654-2.162c1.756-0.471,3.595-0.708,5.526-0.708c1.44,0,2.62,0.036,3.546,0.107 c0.918,0.063,1.69,0.145,2.322,0.236v-1.28h-0.009v-0.003H638.94z M638.94,67.465c-0.67-0.089-1.526-0.18-2.562-0.268 c-1.034-0.091-1.908-0.137-2.628-0.137c-2.786,0-4.911,0.518-6.366,1.554c-1.465,1.033-2.192,2.607-2.192,4.72 c0,1.345,0.242,2.405,0.739,3.168c0.493,0.768,1.112,1.345,1.856,1.759c0.738,0.403,1.558,0.647,2.457,0.738 c0.896,0.092,1.757,0.135,2.562,0.135c1.033,0,2.103-0.055,3.205-0.17c1.102-0.109,2.076-0.283,2.929-0.505V67.465L638.94,67.465 z'/%3E%3Cpath class='st1' d='M674.061,79.262c3.999,0.089,6.898,0.941,8.696,2.562c1.795,1.62,2.696,3.841,2.696,6.672 c0,1.841-0.469,3.491-1.414,4.956c-0.938,1.459-2.244,2.717-3.906,3.772c-1.667,1.057-3.631,1.867-5.898,2.43 c-2.269,0.561-4.73,0.842-7.381,0.842c-4.631,0-8.155-0.719-10.582-2.156c-2.431-1.44-3.642-3.71-3.642-6.809 c0-1.844,0.493-3.493,1.483-4.953c0.99-1.462,2.267-2.623,3.841-3.473c-0.898-0.585-1.649-1.315-2.257-2.194 c-0.609-0.87-0.911-1.967-0.911-3.268c0-1.66,0.368-3.101,1.114-4.314c0.739-1.213,1.738-2.292,2.999-3.234 c-1.483-1.034-2.674-2.372-3.573-4.014c-0.899-1.637-1.348-3.493-1.348-5.559c0-1.706,0.316-3.305,0.942-4.788 c0.63-1.484,1.541-2.776,2.733-3.876c1.19-1.101,2.657-1.966,4.414-2.597c1.754-0.627,3.753-0.941,6-0.941 c2.021,0,3.848,0.293,5.49,0.873c1.638,0.587,3.045,1.329,4.212,2.228c0.9-0.719,2.113-1.315,3.642-1.788 c1.528-0.472,3.212-0.708,5.058-0.708c0.176,0.855,0.268,1.799,0.268,2.83c0,0.496-0.024,1.012-0.069,1.552 c-0.042,0.537-0.108,1.076-0.199,1.617h-6.064c0.491,0.765,0.87,1.596,1.142,2.496c0.266,0.896,0.4,1.933,0.4,3.1 c0,1.841-0.334,3.509-1.01,4.99c-0.67,1.485-1.626,2.752-2.863,3.809c-1.233,1.057-2.706,1.866-4.412,2.427 c-1.709,0.564-3.575,0.843-5.596,0.843c-1.844,0-3.507-0.203-4.993-0.604c-0.627,0.36-1.247,0.911-1.853,1.65 c-0.604,0.741-0.911,1.541-0.911,2.392c0,0.807,0.291,1.518,0.878,2.119c0.583,0.61,1.885,0.934,3.909,0.98L674.061,79.262z M664.959,84.587c-2.023-0.046-3.542,0.496-4.547,1.623c-1.014,1.122-1.519,2.468-1.519,4.041c0,0.988,0.203,1.798,0.603,2.43 c0.403,0.627,0.984,1.135,1.719,1.512c0.741,0.381,1.62,0.654,2.631,0.811c1.011,0.157,2.12,0.239,3.339,0.239 c3.594,0,6.403-0.594,8.426-1.787c2.023-1.194,3.033-2.687,3.033-4.483c0-1.348-0.429-2.382-1.279-3.1 c-0.857-0.725-2.425-1.105-4.72-1.145L664.959,84.587z M668.062,67.735c2.425,0,4.222-0.675,5.393-2.023 c1.167-1.347,1.752-3.077,1.752-5.192c0-2.159-0.584-3.92-1.752-5.291c-1.17-1.37-2.965-2.056-5.393-2.056 c-2.428,0-4.215,0.687-5.359,2.056c-1.148,1.371-1.719,3.136-1.719,5.291c0,2.112,0.571,3.841,1.719,5.192 C663.845,67.061,665.634,67.735,668.062,67.735z'/%3E%3Cpath class='st1' d='M697.117,68.072c0.091,3.778,1.067,6.54,2.93,8.292c1.862,1.752,4.618,2.63,8.257,2.63 c3.191,0,6.226-0.562,9.099-1.686c0.358,0.672,0.656,1.495,0.876,2.458c0.226,0.97,0.36,1.921,0.407,2.866 c-1.485,0.627-3.113,1.1-4.888,1.414c-1.778,0.309-3.743,0.469-5.897,0.469c-3.143,0-5.839-0.44-8.089-1.313 c-2.251-0.876-4.104-2.112-5.563-3.709c-1.46-1.594-2.528-3.483-3.204-5.662c-0.673-2.176-1.008-4.576-1.008-7.181 c0-2.562,0.327-4.951,0.978-7.183c0.652-2.224,1.647-4.153,2.999-5.794c1.348-1.639,3.045-2.941,5.09-3.909 c2.043-0.967,4.457-1.449,7.247-1.449c2.381,0,4.474,0.404,6.272,1.213c1.794,0.805,3.304,1.918,4.514,3.335 c1.213,1.416,2.136,3.102,2.765,5.055c0.627,1.955,0.944,4.08,0.944,6.368c0,0.633-0.024,1.296-0.066,1.993 c-0.045,0.698-0.091,1.292-0.137,1.785L697.117,68.072L697.117,68.072z M714.237,63.084c0-1.257-0.167-2.458-0.505-3.608 c-0.337-1.145-0.833-2.146-1.483-3.003c-0.653-0.852-1.483-1.538-2.494-2.054c-1.007-0.517-2.214-0.775-3.605-0.775 c-2.746,0-4.845,0.832-6.302,2.496c-1.465,1.664-2.358,3.974-2.666,6.939h17.056V63.084L714.237,63.084z'/%3E%3Cpath class='st1' d='M729.607,49.131c0.494-0.089,0.962-0.16,1.416-0.203c0.447-0.045,0.921-0.067,1.411-0.067 c0.493,0,0.988,0.022,1.483,0.067c0.496,0.043,0.941,0.114,1.345,0.203c0.135,0.675,0.27,1.561,0.404,2.661 c0.137,1.101,0.204,2.034,0.204,2.796c0.942-1.526,2.189-2.853,3.74-3.977c1.554-1.124,3.537-1.686,5.966-1.686 c0.361,0,0.727,0.014,1.114,0.033c0.378,0.026,0.706,0.057,0.974,0.104c0.091,0.403,0.161,0.832,0.206,1.28 c0.043,0.448,0.066,0.921,0.066,1.415c0,0.537-0.034,1.101-0.104,1.687c-0.066,0.583-0.148,1.143-0.236,1.682 c-0.36-0.089-0.731-0.132-1.112-0.132c-0.384,0-0.685,0-0.909,0c-1.216,0-2.374,0.168-3.477,0.503 c-1.101,0.337-2.09,0.934-2.966,1.788c-0.872,0.857-1.574,2.025-2.086,3.507c-0.521,1.482-0.777,3.394-0.777,5.73v17.187 c-0.498,0.091-1.046,0.158-1.653,0.204c-0.606,0.042-1.155,0.066-1.649,0.066c-0.496,0-1.044-0.024-1.653-0.066 c-0.606-0.044-1.18-0.114-1.718-0.204V49.131H729.607z'/%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/svg%3E%0A");
		background-position: center;
		background-repeat: no-repeat;
		background-size: 220px;
	}

	.wtm_wsp h2{
		font-family: sans-serif;
		font-weight: 300;
		font-size: 26px;
		padding: 20px 0 5px 0;
		margin: 0 0 20px 0;
		color: #55636b;
		background-color: #fff;
	}

	.wtm_wsp p{
		font-family: Verdana;
		font-size: 12px; 
		color: rgba(255,255,255,0.85); 
		padding: 10px 30px;
	}
	
	
	.wtm_wsp input {
		margin: 5px;
		width: 220px;
		padding: 5px 10px;
		color: #2A9289;
		font-size: 16px;
		font-weight: normal;
		border-radius: 5px;
		border: 0;
		outline: none;
	}

	.wtm_wsp input:focus {
		color: #195e58;
	}

	.wtm_wsp button {
		width: 150px;
		padding: 6px 0;
		margin: 20px 0 40px 0;
		background-color: #eee;
		border-radius: 5px;
		font-size: 16px;
		color: #435058;
	}
	
	.wtm_wsp button:disabled {
		color: #c9c9c9;
	}

	.wtm_wsp p.loading{
		font-family: Verdana;
		font-size: 16px; 
		letter-spacing: 1px;
		color: rgba(255,255,255,0.9); 
		padding: 10px 30px;
		margin: 30px 0 0 0;
	}

	.wtm_wsp p.error{
		display: block;
		font-family:sans-serif;
		line-height: 160%;
		margin: 50px auto 0 auto;
		padding: 10px 20px;
		background: #fff;
		border:2px solid rgba(0,0,0,.1);
		color: brown;
		font-weight: bold;
		font-size: 16px;
	}
</style>
<div class="wtm_wsp">
	<div class="logo"></div>
	<h2>Ativar o Winco Talk Manager para WhatsApp<span style="font-size: 11px;vertical-align: top;">&copy;</span></h2>
	<p>O telefone deve estar previamente cadastrado na Winco.</p>
	<form onsubmit="return false;" method="post">
		<input type="hidden" name="cmd" value="associate" />
		<input type="hidden" name="product_code" value="w4b" />
		<input type="hidden" name="qr_code" />
		<input type="text" name="vd_number" placeholder="Telefone" /><br />
		<input type="text" name="vd_key"    placeholder="Chave de ativação" /><br />
		<button id="wtmwsp_submit" class="disable">Ativar</button>
	</form>
	<p class="loading" style="display:none;"></p>
	<p class="error"   style="display:none;">Error: xxx</p>
</div>
`;

const htmlContactForm = 
`<style>
	.wtm_wsp {
		text-align: center;
		user-select: auto;
		display: inline-block;
		width: 100%;
		height: 100%;
		background-color: #1ebea5;
	}

	.wtm_wsp input::selection {
		background: #ccf !important;
	}

	.logo{
		width: 100%;
		height: 60px;
		background-color: #fff;
		background-image: url("data:image/svg+xml,%3Csvg version='1.1' id='Layer_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='7.935 2.125 750 105.548' style='enable-background:new 7.935 2.125 750 105.548;' xml:space='preserve'%3E%3Cstyle type='text/css'%3E .st0%7Bfill:%2343A147;%7D .st1%7Bfill:%23274E66;%7D .st2%7Benable-background:new ;%7D%0A%3C/style%3E%3Cg%3E%3Cg%3E%3Cpolygon class='st0' points='53.607,33.582 53.421,82.442 75.801,62.114 75.903,33.582 '/%3E%3C/g%3E%3Cg%3E%3Cg%3E%3Cpath class='st1' d='M117.013,56.229c-3.868,9.194-10.572,18.379-19.753,26.165c-22.814,19.354-52.234,22.708-65.711,7.499 c-13.477-15.212-5.907-43.228,16.909-62.578c22.814-19.351,52.236-22.705,65.713-7.497c2.534,2.861,4.324,6.175,5.409,9.799 h7.288c-1.232-5.319-3.624-10.194-7.279-14.317C103.579-2.768,69.694,0.313,43.91,22.181 c-25.786,21.87-33.709,54.246-17.7,72.318c16.011,18.065,49.896,14.988,75.679-6.884c13.547-11.487,22.156-25.879,24.962-39.571 L117.013,56.229z'/%3E%3C/g%3E%3Cpath class='st0' d='M78.957,78.412c0.042-7.229,0.077-14.439,0.11-21.647c0.032-7.069,0.065-14.134,0.107-21.199l0.011-1.985 h57.593L78.934,82.766L78.957,78.412z'/%3E%3Cg class='st2'%3E%3Cpath class='st1' d='M145.442,35.245c0.494-0.09,1.111-0.157,1.852-0.203c0.742-0.043,1.427-0.068,2.056-0.068 c0.629,0,1.27,0.024,1.921,0.068c0.653,0.045,1.249,0.113,1.787,0.203l8.293,40.375l9.977-40.375 c0.541-0.09,1.136-0.157,1.786-0.203c0.653-0.043,1.27-0.068,1.855-0.068c0.537,0,1.143,0.024,1.818,0.068 c0.678,0.045,1.258,0.113,1.756,0.203l10.044,40.783l8.426-40.783c0.495-0.09,1.022-0.157,1.583-0.203 c0.56-0.043,1.113-0.068,1.654-0.068c0.627,0,1.269,0.024,1.918,0.068c0.652,0.045,1.226,0.113,1.721,0.203l-11.662,48.466 c-0.539,0.091-1.168,0.158-1.887,0.204c-0.724,0.042-1.371,0.066-1.953,0.066c-0.631,0-1.327-0.024-2.091-0.066 c-0.765-0.044-1.462-0.114-2.091-0.204l-9.574-37.95l-9.707,37.95c-0.629,0.091-1.313,0.158-2.056,0.204 c-0.744,0.042-1.427,0.066-2.056,0.066c-0.541,0-1.157-0.024-1.854-0.066c-0.694-0.044-1.312-0.114-1.853-0.204L145.442,35.245z' /%3E%3Cpath class='st1' d='M213.119,54.388h-4.38c-0.091-0.359-0.16-0.775-0.204-1.244c-0.043-0.473-0.067-0.931-0.067-1.385 c0-0.448,0.022-0.909,0.067-1.382c0.045-0.473,0.112-0.888,0.204-1.246h10.921v34.579c-0.496,0.091-1.046,0.158-1.651,0.204 c-0.609,0.042-1.158,0.066-1.651,0.066c-0.449,0-0.977-0.024-1.585-0.066c-0.609-0.044-1.157-0.114-1.651-0.204V54.388H213.119z M211.638,41.513c-0.094-0.541-0.147-1.125-0.17-1.754c-0.024-0.629-0.035-1.191-0.035-1.686c0-0.493,0.011-1.057,0.035-1.685 c0.023-0.629,0.076-1.19,0.17-1.687c0.586-0.09,1.212-0.157,1.89-0.203c0.673-0.043,1.257-0.068,1.754-0.068 c0.492,0,1.076,0.024,1.752,0.068c0.675,0.044,1.282,0.113,1.821,0.203c0.089,0.498,0.145,1.057,0.17,1.687 c0.022,0.628,0.032,1.192,0.032,1.685c0,0.495-0.011,1.057-0.032,1.686c-0.023,0.629-0.081,1.212-0.17,1.754 c-0.538,0.09-1.136,0.157-1.787,0.201c-0.653,0.046-1.226,0.064-1.72,0.064c-0.539,0-1.145-0.019-1.821-0.064 C212.847,41.67,212.221,41.605,211.638,41.513z'/%3E%3Cpath class='st1' d='M230.51,49.131c0.496-0.089,0.979-0.16,1.448-0.203c0.473-0.045,0.957-0.067,1.452-0.067 c0.493,0,0.952,0.022,1.38,0.067c0.427,0.043,0.886,0.114,1.383,0.203c0.137,0.675,0.27,1.582,0.402,2.729 c0.135,1.146,0.202,2.104,0.202,2.862c0.45-0.762,1.024-1.528,1.72-2.29c0.696-0.765,1.491-1.452,2.392-2.057 c0.898-0.605,1.934-1.101,3.103-1.483c1.169-0.381,2.448-0.573,3.842-0.573c3.955,0,6.874,1.135,8.764,3.404 c1.89,2.268,2.83,5.628,2.83,10.075v21.912c-0.494,0.091-1.055,0.158-1.685,0.204c-0.627,0.042-1.191,0.066-1.686,0.066 c-0.494,0-1.044-0.024-1.653-0.066c-0.605-0.044-1.156-0.114-1.651-0.204V63.624c0-3.189-0.496-5.54-1.481-7.043 c-0.99-1.505-2.563-2.259-4.721-2.259c-1.257,0-2.448,0.226-3.573,0.677c-1.122,0.447-2.11,1.143-2.966,2.088 c-0.855,0.942-1.539,2.171-2.056,3.676c-0.516,1.505-0.776,3.313-0.776,5.422v17.526c-0.495,0.094-1.042,0.161-1.651,0.207 c-0.606,0.039-1.157,0.066-1.653,0.066c-0.495,0-1.058-0.027-1.686-0.066c-0.629-0.045-1.192-0.112-1.686-0.207L230.51,49.131 L230.51,49.131z'/%3E%3Cpath class='st1' d='M292.528,77.712c0.358,0.627,0.674,1.41,0.942,2.359c0.27,0.942,0.426,1.909,0.472,2.897 c-2.652,1.036-5.686,1.551-9.102,1.551c-5.753,0-10.089-1.624-13.008-4.884c-2.924-3.26-4.38-7.652-4.38-13.18 c0-2.565,0.36-4.943,1.077-7.144c0.719-2.201,1.786-4.114,3.203-5.731c1.413-1.618,3.18-2.898,5.288-3.841 c2.115-0.942,4.563-1.414,7.348-1.414c1.887,0,3.55,0.114,4.987,0.337c1.441,0.223,2.809,0.585,4.111,1.078 c0,0.766-0.103,1.652-0.303,2.661c-0.199,1.012-0.483,1.9-0.842,2.667c-2.205-0.767-4.719-1.149-7.552-1.149 c-3.461,0-6.043,1.149-7.754,3.441c-1.707,2.293-2.559,5.326-2.559,9.099c0,4.31,0.965,7.469,2.896,9.473 c1.934,1.997,4.585,2.998,7.956,2.998c1.347,0,2.595-0.088,3.74-0.268C290.2,78.481,291.358,78.161,292.528,77.712z'/%3E%3Cpath class='st1' d='M314.704,84.521c-2.696,0-5.054-0.46-7.075-1.381c-2.023-0.924-3.707-2.192-5.057-3.809 c-1.349-1.618-2.348-3.527-2.999-5.73c-0.654-2.201-0.98-4.583-0.98-7.144c0-2.558,0.325-4.943,0.98-7.144 c0.651-2.201,1.649-4.114,2.999-5.731c1.344-1.618,3.033-2.898,5.057-3.841c2.024-0.941,4.38-1.414,7.075-1.414 c2.698,0,5.057,0.474,7.076,1.414c2.024,0.943,3.706,2.225,5.057,3.841c1.348,1.618,2.35,3.53,3,5.731 c0.655,2.201,0.981,4.586,0.981,7.144c0,2.561-0.327,4.943-0.981,7.144c-0.65,2.202-1.651,4.111-3,5.73 c-1.348,1.617-3.033,2.887-5.057,3.809C319.761,84.057,317.4,84.521,314.704,84.521z M314.704,79.195 c3.101,0,5.394-1.122,6.879-3.37c1.483-2.246,2.222-5.369,2.222-9.366c0-3.999-0.739-7.111-2.222-9.337 c-1.485-2.226-3.78-3.341-6.879-3.341c-3.099,0-5.382,1.115-6.841,3.341c-1.463,2.228-2.19,5.338-2.19,9.337 c0,3.998,0.727,7.121,2.19,9.366C309.321,78.071,311.602,79.195,314.704,79.195z'/%3E%3Cpath class='st1' d='M364.454,41.243h-12.608c-0.091-0.448-0.157-0.943-0.203-1.483c-0.046-0.536-0.068-1.056-0.068-1.549 c0-0.495,0.022-1,0.068-1.515c0.045-0.517,0.111-1.001,0.203-1.451h32.087c0.092,0.448,0.16,0.922,0.204,1.415 c0.043,0.495,0.068,0.99,0.068,1.483c0,0.496-0.024,1.021-0.068,1.583c-0.043,0.564-0.111,1.068-0.204,1.518h-12.602v42.467 c-1.037,0.134-2.161,0.204-3.372,0.204c-1.259,0-2.425-0.07-3.503-0.204L364.454,41.243L364.454,41.243z'/%3E%3Cpath class='st1' d='M404.559,60.929c0-2.653-0.672-4.496-2.023-5.531c-1.344-1.033-3.301-1.549-5.866-1.549 c-1.571,0-3.044,0.122-4.415,0.371c-1.368,0.249-2.707,0.574-4.011,0.978c-0.859-1.484-1.28-3.257-1.28-5.328 c1.528-0.493,3.211-0.875,5.058-1.146c1.844-0.268,3.617-0.402,5.327-0.402c4.493,0,7.905,1.023,10.243,3.068 c2.335,2.044,3.507,5.313,3.507,9.809v21.639c-1.577,0.36-3.484,0.726-5.731,1.111c-2.248,0.383-4.539,0.574-6.876,0.574 c-2.203,0-4.189-0.204-5.966-0.607c-1.774-0.401-3.278-1.056-4.514-1.953c-1.24-0.899-2.189-2.047-2.867-3.441 c-0.672-1.391-1.007-3.071-1.007-5.054c0-1.933,0.39-3.625,1.18-5.088c0.787-1.46,1.854-2.674,3.201-3.64 c1.348-0.968,2.9-1.689,4.654-2.162c1.755-0.471,3.596-0.708,5.529-0.708c1.436,0,2.617,0.036,3.54,0.107 c0.923,0.063,1.695,0.145,2.323,0.236v-1.28h-0.007v-0.003H404.559z M404.559,67.465c-0.672-0.089-1.528-0.18-2.561-0.268 c-1.034-0.091-1.909-0.137-2.631-0.137c-2.785,0-4.911,0.518-6.369,1.554c-1.46,1.033-2.189,2.607-2.189,4.72 c0,1.345,0.243,2.405,0.739,3.168c0.491,0.768,1.113,1.345,1.857,1.759c0.74,0.403,1.558,0.647,2.457,0.738 c0.899,0.092,1.755,0.135,2.561,0.135c1.036,0,2.103-0.055,3.204-0.17c1.103-0.109,2.079-0.283,2.929-0.505L404.559,67.465 L404.559,67.465z'/%3E%3Cpath class='st1' d='M421.009,34.3c0.498-0.089,1.044-0.158,1.651-0.2c0.607-0.047,1.156-0.07,1.651-0.07 c0.493,0,1.044,0.024,1.651,0.07c0.603,0.042,1.155,0.111,1.65,0.2v38.964c0,1.259,0.111,2.246,0.337,2.965 c0.22,0.721,0.524,1.267,0.911,1.65c0.381,0.383,0.831,0.629,1.346,0.744c0.515,0.109,1.066,0.17,1.65,0.17 c0.403,0,0.866-0.026,1.383-0.069c0.516-0.044,0.952-0.106,1.315-0.203c0.406,1.575,0.603,3.281,0.603,5.121 c-0.627,0.229-1.391,0.375-2.292,0.443c-0.898,0.068-1.728,0.102-2.492,0.102c-1.305,0-2.519-0.155-3.64-0.472 c-1.128-0.312-2.113-0.829-2.966-1.552c-0.857-0.718-1.526-1.685-2.024-2.897c-0.498-1.211-0.741-2.717-0.741-4.517L421.009,34.3 L421.009,34.3z'/%3E%3Cpath class='st1' d='M440.957,34.3c0.498-0.089,1.047-0.158,1.651-0.2c0.609-0.047,1.159-0.07,1.651-0.07 c0.495,0,1.06,0.024,1.692,0.07c0.626,0.042,1.188,0.111,1.683,0.2v49.41c-0.495,0.091-1.056,0.158-1.683,0.204 c-0.63,0.042-1.194,0.066-1.692,0.066c-0.493,0-1.043-0.024-1.651-0.066c-0.604-0.044-1.155-0.114-1.651-0.204V34.3z M449.455,65.779l10.989-16.651c0.583-0.089,1.167-0.158,1.752-0.203c0.586-0.045,1.194-0.065,1.823-0.065 c0.673,0,1.316,0.02,1.921,0.065c0.604,0.045,1.22,0.114,1.851,0.203l-10.985,16.177l12.872,18.398 c-0.629,0.094-1.237,0.162-1.823,0.207c-0.583,0.04-1.192,0.066-1.818,0.066c-0.63,0-1.26-0.026-1.887-0.066 c-0.636-0.043-1.263-0.112-1.89-0.207L449.455,65.779z'/%3E%3Cpath class='st1' d='M493.744,35.245c0.536-0.09,1.154-0.157,1.851-0.203c0.696-0.043,1.355-0.068,1.991-0.068 c0.626,0,1.316,0.024,2.053,0.068c0.744,0.045,1.359,0.113,1.853,0.203l12.54,30.333l12.608-30.333 c0.447-0.09,1.008-0.157,1.682-0.203c0.678-0.043,1.325-0.068,1.961-0.068c0.583,0,1.236,0.024,1.956,0.068 c0.715,0.045,1.322,0.113,1.817,0.203l2.296,48.466c-0.539,0.091-1.093,0.158-1.651,0.204c-0.564,0.042-1.141,0.066-1.719,0.066 c-0.588,0-1.159-0.024-1.722-0.066c-0.561-0.044-1.089-0.114-1.58-0.204l-1.555-37.682l-11.868,27.638 c-0.899,0.134-1.82,0.201-2.765,0.201c-0.853,0-1.706-0.068-2.561-0.201l-11.461-27.838l-1.551,37.882 c-0.495,0.091-1.006,0.16-1.549,0.207c-0.541,0.039-1.056,0.066-1.552,0.066c-0.584,0-1.142-0.027-1.685-0.066 c-0.539-0.046-1.056-0.115-1.552-0.207L493.744,35.245z'/%3E%3Cpath class='st1' d='M565.127,60.929c0-2.653-0.67-4.496-2.02-5.531c-1.346-1.033-3.303-1.549-5.866-1.549 c-1.572,0-3.047,0.122-4.415,0.371c-1.371,0.249-2.712,0.574-4.014,0.978c-0.857-1.484-1.279-3.257-1.279-5.328 c1.528-0.493,3.209-0.875,5.054-1.146c1.847-0.268,3.621-0.402,5.331-0.402c4.494,0,7.905,1.023,10.242,3.068 c2.336,2.044,3.506,5.313,3.506,9.809v21.639c-1.574,0.36-3.484,0.726-5.73,1.111c-2.249,0.383-4.54,0.574-6.876,0.574 c-2.201,0-4.192-0.204-5.969-0.607c-1.774-0.401-3.28-1.056-4.514-1.953c-1.236-0.899-2.191-2.047-2.866-3.441 c-0.67-1.391-1.006-3.071-1.006-5.054c0-1.933,0.393-3.625,1.181-5.088c0.784-1.46,1.852-2.674,3.199-3.64 c1.348-0.968,2.897-1.689,4.654-2.162c1.754-0.471,3.596-0.708,5.527-0.708c1.437,0,2.617,0.036,3.54,0.107 c0.924,0.063,1.696,0.145,2.325,0.236v-1.28h-0.009v-0.003H565.127z M565.127,67.465c-0.67-0.089-1.525-0.18-2.556-0.268 c-1.039-0.091-1.912-0.137-2.634-0.137c-2.785,0-4.914,0.518-6.37,1.554c-1.46,1.033-2.188,2.607-2.188,4.72 c0,1.345,0.242,2.405,0.738,3.168c0.492,0.768,1.114,1.345,1.857,1.759c0.739,0.403,1.561,0.647,2.458,0.738 c0.901,0.092,1.754,0.135,2.562,0.135c1.033,0,2.099-0.055,3.201-0.17c1.102-0.109,2.082-0.283,2.932-0.505V67.465 L565.127,67.465z'/%3E%3Cpath class='st1' d='M581.711,49.131c0.498-0.089,0.98-0.16,1.449-0.203c0.472-0.045,0.954-0.067,1.454-0.067 c0.493,0,0.949,0.022,1.384,0.067c0.424,0.043,0.88,0.114,1.381,0.203c0.13,0.675,0.266,1.582,0.4,2.729 c0.132,1.146,0.203,2.104,0.203,2.862c0.447-0.762,1.023-1.528,1.719-2.29c0.695-0.765,1.495-1.452,2.392-2.057 c0.899-0.605,1.932-1.101,3.103-1.483c1.165-0.381,2.445-0.573,3.841-0.573c3.955,0,6.872,1.135,8.762,3.404 c1.889,2.268,2.833,5.628,2.833,10.075v21.912c-0.495,0.091-1.059,0.158-1.689,0.204c-0.627,0.042-1.191,0.066-1.686,0.066 c-0.495,0-1.044-0.024-1.651-0.066c-0.609-0.044-1.157-0.114-1.653-0.204V63.624c0-3.189-0.495-5.54-1.482-7.043 c-0.99-1.505-2.562-2.259-4.72-2.259c-1.262,0-2.446,0.226-3.573,0.677c-1.124,0.447-2.11,1.143-2.966,2.088 c-0.855,0.947-1.538,2.171-2.057,3.676c-0.515,1.503-0.777,3.313-0.777,5.422v17.526c-0.493,0.094-1.043,0.161-1.649,0.207 c-0.604,0.039-1.161,0.066-1.65,0.066c-0.496,0-1.057-0.027-1.686-0.066c-0.632-0.045-1.193-0.112-1.69-0.207V49.131H581.711z'/%3E%3Cpath class='st1' d='M638.94,60.929c0-2.653-0.67-4.496-2.021-5.531c-1.349-1.033-3.304-1.549-5.866-1.549 c-1.572,0-3.045,0.122-4.416,0.371c-1.37,0.249-2.706,0.574-4.011,0.978c-0.859-1.484-1.282-3.257-1.282-5.328 c1.529-0.493,3.214-0.875,5.059-1.146c1.84-0.268,3.617-0.402,5.327-0.402c4.495,0,7.905,1.023,10.241,3.068 c2.335,2.044,3.509,5.313,3.509,9.809v21.639c-1.578,0.36-3.483,0.726-5.733,1.111c-2.25,0.383-4.537,0.574-6.876,0.574 c-2.201,0-4.188-0.204-5.964-0.607c-1.776-0.401-3.281-1.056-4.516-1.953c-1.237-0.899-2.189-2.047-2.863-3.441 c-0.675-1.391-1.01-3.071-1.01-5.054c0-1.933,0.391-3.625,1.18-5.088c0.788-1.46,1.853-2.674,3.201-3.64 c1.348-0.968,2.9-1.689,4.654-2.162c1.756-0.471,3.595-0.708,5.526-0.708c1.44,0,2.62,0.036,3.546,0.107 c0.918,0.063,1.69,0.145,2.322,0.236v-1.28h-0.009v-0.003H638.94z M638.94,67.465c-0.67-0.089-1.526-0.18-2.562-0.268 c-1.034-0.091-1.908-0.137-2.628-0.137c-2.786,0-4.911,0.518-6.366,1.554c-1.465,1.033-2.192,2.607-2.192,4.72 c0,1.345,0.242,2.405,0.739,3.168c0.493,0.768,1.112,1.345,1.856,1.759c0.738,0.403,1.558,0.647,2.457,0.738 c0.896,0.092,1.757,0.135,2.562,0.135c1.033,0,2.103-0.055,3.205-0.17c1.102-0.109,2.076-0.283,2.929-0.505V67.465L638.94,67.465 z'/%3E%3Cpath class='st1' d='M674.061,79.262c3.999,0.089,6.898,0.941,8.696,2.562c1.795,1.62,2.696,3.841,2.696,6.672 c0,1.841-0.469,3.491-1.414,4.956c-0.938,1.459-2.244,2.717-3.906,3.772c-1.667,1.057-3.631,1.867-5.898,2.43 c-2.269,0.561-4.73,0.842-7.381,0.842c-4.631,0-8.155-0.719-10.582-2.156c-2.431-1.44-3.642-3.71-3.642-6.809 c0-1.844,0.493-3.493,1.483-4.953c0.99-1.462,2.267-2.623,3.841-3.473c-0.898-0.585-1.649-1.315-2.257-2.194 c-0.609-0.87-0.911-1.967-0.911-3.268c0-1.66,0.368-3.101,1.114-4.314c0.739-1.213,1.738-2.292,2.999-3.234 c-1.483-1.034-2.674-2.372-3.573-4.014c-0.899-1.637-1.348-3.493-1.348-5.559c0-1.706,0.316-3.305,0.942-4.788 c0.63-1.484,1.541-2.776,2.733-3.876c1.19-1.101,2.657-1.966,4.414-2.597c1.754-0.627,3.753-0.941,6-0.941 c2.021,0,3.848,0.293,5.49,0.873c1.638,0.587,3.045,1.329,4.212,2.228c0.9-0.719,2.113-1.315,3.642-1.788 c1.528-0.472,3.212-0.708,5.058-0.708c0.176,0.855,0.268,1.799,0.268,2.83c0,0.496-0.024,1.012-0.069,1.552 c-0.042,0.537-0.108,1.076-0.199,1.617h-6.064c0.491,0.765,0.87,1.596,1.142,2.496c0.266,0.896,0.4,1.933,0.4,3.1 c0,1.841-0.334,3.509-1.01,4.99c-0.67,1.485-1.626,2.752-2.863,3.809c-1.233,1.057-2.706,1.866-4.412,2.427 c-1.709,0.564-3.575,0.843-5.596,0.843c-1.844,0-3.507-0.203-4.993-0.604c-0.627,0.36-1.247,0.911-1.853,1.65 c-0.604,0.741-0.911,1.541-0.911,2.392c0,0.807,0.291,1.518,0.878,2.119c0.583,0.61,1.885,0.934,3.909,0.98L674.061,79.262z M664.959,84.587c-2.023-0.046-3.542,0.496-4.547,1.623c-1.014,1.122-1.519,2.468-1.519,4.041c0,0.988,0.203,1.798,0.603,2.43 c0.403,0.627,0.984,1.135,1.719,1.512c0.741,0.381,1.62,0.654,2.631,0.811c1.011,0.157,2.12,0.239,3.339,0.239 c3.594,0,6.403-0.594,8.426-1.787c2.023-1.194,3.033-2.687,3.033-4.483c0-1.348-0.429-2.382-1.279-3.1 c-0.857-0.725-2.425-1.105-4.72-1.145L664.959,84.587z M668.062,67.735c2.425,0,4.222-0.675,5.393-2.023 c1.167-1.347,1.752-3.077,1.752-5.192c0-2.159-0.584-3.92-1.752-5.291c-1.17-1.37-2.965-2.056-5.393-2.056 c-2.428,0-4.215,0.687-5.359,2.056c-1.148,1.371-1.719,3.136-1.719,5.291c0,2.112,0.571,3.841,1.719,5.192 C663.845,67.061,665.634,67.735,668.062,67.735z'/%3E%3Cpath class='st1' d='M697.117,68.072c0.091,3.778,1.067,6.54,2.93,8.292c1.862,1.752,4.618,2.63,8.257,2.63 c3.191,0,6.226-0.562,9.099-1.686c0.358,0.672,0.656,1.495,0.876,2.458c0.226,0.97,0.36,1.921,0.407,2.866 c-1.485,0.627-3.113,1.1-4.888,1.414c-1.778,0.309-3.743,0.469-5.897,0.469c-3.143,0-5.839-0.44-8.089-1.313 c-2.251-0.876-4.104-2.112-5.563-3.709c-1.46-1.594-2.528-3.483-3.204-5.662c-0.673-2.176-1.008-4.576-1.008-7.181 c0-2.562,0.327-4.951,0.978-7.183c0.652-2.224,1.647-4.153,2.999-5.794c1.348-1.639,3.045-2.941,5.09-3.909 c2.043-0.967,4.457-1.449,7.247-1.449c2.381,0,4.474,0.404,6.272,1.213c1.794,0.805,3.304,1.918,4.514,3.335 c1.213,1.416,2.136,3.102,2.765,5.055c0.627,1.955,0.944,4.08,0.944,6.368c0,0.633-0.024,1.296-0.066,1.993 c-0.045,0.698-0.091,1.292-0.137,1.785L697.117,68.072L697.117,68.072z M714.237,63.084c0-1.257-0.167-2.458-0.505-3.608 c-0.337-1.145-0.833-2.146-1.483-3.003c-0.653-0.852-1.483-1.538-2.494-2.054c-1.007-0.517-2.214-0.775-3.605-0.775 c-2.746,0-4.845,0.832-6.302,2.496c-1.465,1.664-2.358,3.974-2.666,6.939h17.056V63.084L714.237,63.084z'/%3E%3Cpath class='st1' d='M729.607,49.131c0.494-0.089,0.962-0.16,1.416-0.203c0.447-0.045,0.921-0.067,1.411-0.067 c0.493,0,0.988,0.022,1.483,0.067c0.496,0.043,0.941,0.114,1.345,0.203c0.135,0.675,0.27,1.561,0.404,2.661 c0.137,1.101,0.204,2.034,0.204,2.796c0.942-1.526,2.189-2.853,3.74-3.977c1.554-1.124,3.537-1.686,5.966-1.686 c0.361,0,0.727,0.014,1.114,0.033c0.378,0.026,0.706,0.057,0.974,0.104c0.091,0.403,0.161,0.832,0.206,1.28 c0.043,0.448,0.066,0.921,0.066,1.415c0,0.537-0.034,1.101-0.104,1.687c-0.066,0.583-0.148,1.143-0.236,1.682 c-0.36-0.089-0.731-0.132-1.112-0.132c-0.384,0-0.685,0-0.909,0c-1.216,0-2.374,0.168-3.477,0.503 c-1.101,0.337-2.09,0.934-2.966,1.788c-0.872,0.857-1.574,2.025-2.086,3.507c-0.521,1.482-0.777,3.394-0.777,5.73v17.187 c-0.498,0.091-1.046,0.158-1.653,0.204c-0.606,0.042-1.155,0.066-1.649,0.066c-0.496,0-1.044-0.024-1.653-0.066 c-0.606-0.044-1.18-0.114-1.718-0.204V49.131H729.607z'/%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/svg%3E%0A");
		background-position: center;
		background-repeat: no-repeat;
		background-size: 220px;
	}

	.wtm_wsp h2{
		font-family: sans-serif;
		font-weight: 300;
		font-size: 26px;
		padding: 20px 0 5px 0;
		margin: 0 0 20px 0;
		color: #55636b;
		background-color: #fff;
	}

	.wtm_wsp p{
		font-family: Verdana;
		font-size: 12px; 
		color: rgba(255,255,255,0.85); 
		padding: 10px 30px;
	}
	
	
	.wtm_wsp input {
		margin: 5px;
		width: 220px;
		padding: 5px 10px;
		color: #2A9289;
		font-size: 16px;
		font-weight: normal;
		border-radius: 5px;
		border: 0;
		outline: none;
	}

	.wtm_wsp input:focus {
		color: #195e58;
	}

	.wtm_wsp button {
		width: 150px;
		padding: 6px 0;
		margin: 20px 0 40px 0;
		background-color: #eee;
		border-radius: 5px;
		font-size: 16px;
		color: #435058;
	}
	
	.wtm_wsp button:disabled {
		color: #c9c9c9;
	}

	.wtm_wsp p.loading{
		font-family: Verdana;
		font-size: 16px; 
		letter-spacing: 1px;
		color: rgba(255,255,255,0.9); 
		padding: 10px 30px;
		margin: 30px 0 0 0;
	}

	.wtm_wsp p.error{
		display: block;
		width: 400px;
		font-family:sans-serif;
		line-height: 160%;
		margin: 50px auto 0 auto;
		padding: 10px 20px;
		background: #fff;
		border:2px solid rgba(0,0,0,.1);
		color: brown;
		font-weight: bold;
		font-size: 16px;
	}
</style>
<div class="wtm_wsp" id="wtm-activate-whastapp">
	<div class="logo"></div>
	<h2>Cadastrar novo contato</h2>
	<form onsubmit="return false;">
		<p>O telefone deve estar completo com país e DDD, com ou sem separadores.</p>
		<input type="text" name="contact_name"  id="contact_name"  placeholder="Nome do contato" /><br />
		<input type="text" name="contact_phone" id="contact_phone" placeholder="Telefone" /><br />
		<button id="contact_submit" class="disable">Cadastrar</button>
		<button id="contact_back">Voltar</button>
	</form>
	<p style="display: none;" class="loading" id="show_success">
		Seu novo contato foi cadastrado com sucesso. Para enviar uma mensagem, inicie um novo chat e procure pelo nome ou pelo número cadastrado.
		<br/>
		<button id="contact_close" class="disable">Fechar</button>
	</p>
	<p style="display: none;" class="error">Error: xxx</p>
</div>
`;

var config = {
	cluster: 'itrader.talkmanager.net',
	session: {
		base_url: ''
	},
	params: {
		set: (key, val)	=> localStorage.setItem(key, val),
		get: (key)      => { return localStorage.getItem(key) }
	}
};

// WTM communication
wtm = {
	vds_info:   null,
	panel:      null,
	document:   null,
	observers: {},
	disconnect_min_retry: 120000,
	last_disconnect: 0,
	timercount: 0,
	registered_contacts: {},

	check_for_landing: () => {
		var landing = _('div.landing-main');
		if (landing) {
			// look for the timeout.
			if (_(landing, 'button'))
				return 'TIMEOUT';
			else
				return 'BARCODE';
		}
		return 'unknown';
	},

	read_barcode: () => {
		var bc = _('img[alt="Scan me!"');

		if (!bc) {
			canvas = true;
			bc = _('canvas[aria-label="Scan me!"');
		}
		alert(bc.toDataURL('image/png'));
		console.log(bc.toDataURL('image/png'));
		if (bc) {
			// check if the code is still valid.
			var span = _(bc.parentNode, 'span');
			if (!span || !span.firstChild) {
				if (!canvas) return bc.src;
				else return bc.toDataURL('image/png');
			}
		}
		return null;
	},
	check_for_disconnection: () => {
		let disc = _('span[data-testid=alert-phone]');
		return disc != null;
	},

	open_wtm_login: () => {
		// do not create the form thice.
		if (wtm.panel != null)
			return;

		config.params.set('phone_number', null);
		config.params.set('vd_key', null);

		wtm.panel = document.createElement('div');
		wtm.panel.id = 'wtm-activate-whastapp';
		wtm.panel.style.cssText = 'position: fixed; top: 0; left: 0; bottom: 0; right: 0; background-color: white; z-index: 999; text-align: center';
		if (wtm)
		wtm.panel.innerHTML = htmlActivationForm;

		_(wtm.panel, '#wtmwsp_submit').addEventListener('click', (_event) => {
			_(wtm.panel, '#wtmwsp_submit').setAttribute('disabled', 'disabled');
			wtm.getinstance(_(wtm.panel, 'input[name=vd_number]').value, _(wtm.panel, 'input[name=vd_key]').value);
		});

		document.lastChild.appendChild(wtm.panel);
		_(wtm.panel, 'input[name=vd_number]').focus();
	},

	close_wtm_panel: () => {
		if (wtm.panel) {
			wtm.panel.remove();
			wtm.panel = null;
		}
	},

	open_contact_panel: () => {
		wtm.contact = document.createElement('div');
		wtm.contact.id = 'wtm-add-contact';
		wtm.contact.style.cssText = 'position: fixed; top: 0; left: 0; bottom: 0; right: 0; background-color: white; z-index: 999; text-align: center';
		wtm.contact.innerHTML = htmlContactForm;

		_(wtm.contact, '#contact_submit').addEventListener('click', (_evt) => { wtm.register_contact(); return false; } );
		_(wtm.contact, '#contact_back'  ).addEventListener('click', (_evt) => { wtm.close_contact_panel(); return false; } );
		_(wtm.contact, '#contact_close'  ).addEventListener('click', (_evt) => { wtm.close_contact_panel(); return false; } );

		document.lastChild.appendChild(wtm.contact);
		_(wtm.contact, '#contact_name').focus();
	},

	close_contact_panel: () => {
		if (wtm.contact) {
			wtm.contact.remove();
			wtm.contact = null;
		}
	},

	register_contact: () => {
		_(wtm.contact, 'p.error').style.display = 'none';
		_(wtm.contact, '#contact_submit').setAttribute('disabled', 'disabled');

		let data = new FormData(_(wtm.contact, 'form'));
		data.append('vd_number', config.params.get('phone_number'));
		data.append('vd_key', config.params.get('act_token'));

		fetch(`${config.session.base_url}?cmd=regcontact`, { method: 'POST', body: data })
			.then(response  => response.text() )
			.then(value     => {
				obj = JSON.parse(value);
				if (obj.success) {
					_(wtm.contact, 'form').style.display = 'none';
					_(wtm.contact, '#show_success').style.display = '';
				}
				else throw obj.message;
			})
			.catch(err  => {
				_(wtm.contact, 'p.error').innerHTML = err;
				_(wtm.contact, 'p.error').style.display = '';
				_(wtm.contact, '#contact_submit').removeAttribute('disabled');
			})
	},

	getinstance2: (number) => {
		console.log("Teste2");
		fetch('https://' + config.cluster + '/wsvc/getinstance.wsvc?vd_number='+number)
			.then(response => response.text())
			.then(value => {
				var arr = value.split("\r\n");
				var status = arr.shift();
				if (status != 'OK')
					throw status.substr(7);
				wtm.vds_info = {
					service_uri: ''
				};
				for (line of arr) {
					var eq = line.indexOf('=');
					if (eq > 0)
						wtm.vds_info[line.substr(0, eq)] = line.substr(eq + 1);
				}
				config.session.base_url = `https://${wtm.vds_info['worker_frontend']}${wtm.vds_info['service_uri']}`;
			})
	},

	getinstance: (number, key) => {
		console.log("Teste");
		let data = new FormData;
		data.append('vd_key', key);
		data.append('activate', '1');

		_(wtm.panel,'.loading').innerHTML = 'Contactando '+ config.cluster + '...';
		const controller = new AbortController();
		setTimeout(() => {
			controller.abort('timeout');
			wtm.report_error(new Error('timeout ao tentar fazer requisição de login'));
		}, 120000); // tempo do timeout em ms
		fetch('https://' + config.cluster + '/wsvc/getinstance.wsvc?vd_number='+number, { method: 'POST', body: data, signal: controller.signal })
			.then(response  => response.text() )
			.then(value     => {
				var arr = value.split("\r\n");
				var status = arr.shift();
				if (status != 'OK')
					throw status.substr(7);
				wtm.vds_info = {
					vd_number: null,
					activation_token: null,
					service_uri: ''
				};
				for (line of arr) {
					var eq = line.indexOf('=');
					if (eq > 0)
						wtm.vds_info[line.substr(0, eq)] = line.substr(eq + 1);
				}
				if (wtm.vds_info['vd_status'] != 4) {
					console.log(wtm.vds_info);
					throw 'Este telefone não está pronto para ser usado. Contate o suporte';
				}


				// Saving config file
				config.params.set('phone_number',  wtm.vds_info['vd_number']);
				config.params.set('act_token',     wtm.vds_info['activation_token']);
				config.params.set('vd_key', key);
				
				config.session.base_url = `https://${wtm.vds_info['worker_frontend']}${wtm.vds_info['service_uri']}`;

				// Status update
				_(wtm.panel, '.loading').innerHTML = 'now we will activate...';
				_(wtm.panel, 'input[name=qr_code]').value = wtm.read_barcode();

				// try to activate.
				return fetch(config.session.base_url, {
					method: 'POST',
					body:   new FormData(_(wtm.panel, 'form'))
				});
			})
			.then(response  => response.text())
			.then(text      => wtm.report_status(text))
			.catch(err      => {if (err.name == "AbortError") {err = new Error('timeout ao tentar fazer requisição de login');}; wtm.report_error(err)});
	},

	report_error: (error) => {
		let err = _(wtm.panel, '.error');
		err.innerHTML = error;
		err.style.display = '';
		_(wtm.panel, '.loading').style.display = 'none';
		_(wtm.panel, '#wtmwsp_submit').removeAttribute('disabled')
	},

	report_status: (msg) => {
		let status = _(wtm.panel, '.loading');
		status.style.display = '';
		status.innerHTML = msg;
		_(wtm.panel, '.error').style.display = 'none';
		_(wtm.panel, '#wtmwsp_submit').removeAttribute('disabled')
		localStorage.setItem('__wtm_number', _(wtm.panel, 'input[name=vd_number]').value);
	},

	app_changes_done: false,
	myscroll: false,
	scrollx: 0,

	adjust_app: () => {
		// Fix the geometry, and the scrolling
		if (!wtm.fix_geometry())
			// if it retuns false means that the geometry is not ready, so we must wait a litle
			return;

		wtm.fix_chat_window();
		wtm.fix_attachment();
		wtm.fix_contact_name();

		// create our little button
		wtm.create_button(_('div#side'));
		
		// Deal with the keyboard issue

		wtm.create_dom_watchers();
		wtm.app_changes_done = true;
	},

	create_button: (parent_div) => {
		var btn = document.createElement('DIV');
		btn.style.cssText = 'z-index: 100; bottom: 0; background-color: #ededed; left: 0; right: 0; height: 53px; text-align: center; padding-top:10px;';
		btn.innerHTML =
		`<div style="width: 40px; height: 40px; background-color: #6a6; border-radius: 50%; display: inline-block; cursor: pointer;">
			<svg version="1.1" viewBox="0 0 32 32" style="enable-background:new 0 0 32 32;" xml:space="preserve">
			<style type="text/css">
				.st0{fill:#FFFFFF;}
			</style>
			<path class="st0" d="M19.1,15.7c2.4,0,4.2-1.8,4.2-4.2s-1.8-4.2-4.2-4.2s-4.2,1.8-4.2,4.2S16.6,15.7,19.1,15.7z M26.7,20.9
				c-0.3-0.4-0.6-0.8-0.9-1.1c-0.5-0.6-1.2-1-1.8-1.4c-0.2-0.1-0.4-0.2-0.7-0.3l0,0c-1.1-0.5-2.5-0.9-4.2-0.9s-3.1,0.3-4.2,0.9
				l-0.1,0.1c-0.2,0.1-0.5,0.2-0.7,0.4c-0.6,0.4-1.2,0.8-1.7,1.3c-0.2,0.2-0.5,0.5-0.7,0.8c-0.1,0.1-0.2,0.2-0.2,0.3
				c-0.1,0.1-0.1,0.2-0.2,0.3l0,0c-0.1,0.1-0.1,0.3-0.2,0.4v2.3h16.1v-2.3c0,0-0.1-0.2-0.2-0.4C26.8,21,26.7,21,26.7,20.9z M13.1,13.8
				H10v-3.2H8.1v3.2H4.9v1.9h3.1v3.1H10v-3.1h3.1V13.8z"/>
			</svg>
		</div>`;
		_(btn, 'div').addEventListener('click', () => { wtm.open_contact_panel(); });
		parent_div.appendChild(btn);
	},

	fix_geometry: () => {
		let main_view = _('div#app'); // entire window
		let main_side = _('div#side'); // contact list
		var menu_parent = _('div#app > div > div > div');

		if (menu_parent) {
			menu_parent = menu_parent.nextSibling;
			var div_right_slider 	= menu_parent.firstChild;
			var div_pup_menu 		= menu_parent.lastChild;
		}

		if (!main_view || !main_side || !div_pup_menu || !main_view.firstChild || !div_right_slider
				|| !div_right_slider.nextSibling) {
			return false;
		}

		var pane1 = main_side.parentNode;
		var bothpanes = main_view.firstChild;

		var width = document.getElementsByTagName('body')[0].offsetWidth;
		var height = document.getElementsByTagName('body')[0].offsetHeight;
		console.log(`size: ${width} ${height}`);

		// 1- Double the total width (contacts and messages) and disable scrolling by the user
		bothpanes.style.cssText = 'overflow:hidden; width:' + (width * 2) + 'px';

		// 2- Set the widht of the fix geometry of side panel.
		pane1.style.cssText = 'min-width: ' + width + 'px';

		// 3- Set the width of the popup menus (used for contact info and search)
		div_pup_menu.style.cssText = 'max-width:' + width + 'px';

		// 4- now the camera popup, which is fixed in 2 points.
		div_right_slider.style.cssText = 'min-width:' + width + 'px';
		div_right_slider.nextSibling.style.cssText = 'min-width:' + width + 'px';

		if (wtm.observers.hasOwnProperty('fix_geometry'))
			return;

		//	opens a observer on the message menu
		wtm.observers["fix_geometry"] = new MutationObserver(() => {
			var message_menu = _('#app > div:nth-child(1) > span:nth-child(4) > div');
			var overlay = _('#app > div:nth-child(1) > span:nth-child(2) > div:nth-child(1) > span > div:nth-child(1) > div > div');
			var received_msg = _('.message-in > div > div > span > div')
			var download_toast = _('#app > div:nth-child(1) > span:nth-child(1) > div:nth-child(1) > div:nth-child(1) > div:nth-child(1)');
			var popup_info = _('#app > div > span:nth-child(2) > div > div > div > div > div');
			var report_overlay = _('#app > div > span:nth-child(2) > div > div > div > div > div');
			var main_chat = _('div#main');
			var status = _('div#app > div > span:nth-child(3) > div > span > div > div > div:nth-child(1)');
			var status_view = _('div#app > div');
			var msg_status = _('div#app > div > span:nth-child(3) > div > span > div > div > div:nth-child(2) > div');
			var status_x = _('div#app > div > span:nth-child(3) > div > span > div > div > button > span'); 
			if(status)
			{
				status_x.style.width = width + 'px';
				status.style.width = width + 'px';
				status_view.style.width = width + 'px';
				msg_status.style.visibility = 'hidden';
			}

			if(!main_chat){
				wtm.myscroll = true; _('#app').scrollBy(-2000,0);
			}

			if(report_overlay){
				report_overlay.style.width = '90%';
			}

			if (popup_info) {
				popup_info.style.marginRight = (width / 2) + 'px';
				return;
			}

			if (download_toast) {
				download_toast.style.marginLeft = width + 'px';
				return;
			}

			if (message_menu) {
				//	if the menu exists, the margin is aplied
				if(!received_msg){
					message_menu.style.right = '5%';
				}
				else{
					message_menu.style.left = '60%';
					message_menu.style.right = 'auto';
				}
				return;
			}
			// actions overlay
			if (overlay) {
				overlay.style.minWidth = width + 'px';
				return;
			}
		}).observe(document, {
			childList: true,
			subtree: true
		});

		return true;
	},

	fix_attachment: () => {
		if (wtm.observers.hasOwnProperty('fix_attachment'))
			return;

		wtm.observers["fix_attachment"] = new MutationObserver(() => {
			let width = document.getElementsByTagName('body')[0].offsetWidth;

			let popup_div = _('#app > div > span:nth-child(2)');
			let drawer_middle = _('#app > div > div > div:nth-child(2) > div:nth-child(2)');
			let drawer_container = _(drawer_middle, 'span');
			let camera_div = _(drawer_middle, 'span > div > span > div > div > div > div');
			let attachment_div = _(drawer_middle, 'span > div > span > div > div > div:nth-child(2) > div');
			let contacts_products_div = _(popup_div, 'div > span > div > div');
			let contacts_products_inner_div = _(popup_div, 'div > span > div > div > div');
			let attachment_msg_input = _(drawer_middle, 'span > div > span > div > div > div:nth-child(2) > div > div > div:nth-child(3) > div > div');
			let attachment_camera = _(drawer_middle, 'span > div > span > div > div > div > div > span > div > div');

			if (drawer_container) {
				drawer_container.style.width = width + 'px';
			}

			if (camera_div) {
				camera_div.style.width = width + 'px';
				let took_photo = _(camera_div, "span > div > div > div:nth-child(1)");
				if (took_photo) {
					took_photo.style.width = width + 'px';
					console.log('photo?');
				} else {
					console.log('no photo');
				}
			}

			if (attachment_div) {
				attachment_div.style.minWidth = '0';
			}

			if (contacts_products_div) {
				contacts_products_div.style.minWidth = '0';
			}

			if (contacts_products_inner_div) {
				contacts_products_inner_div.style.maxWidth = '95%';
				contacts_products_inner_div.style.minWidth = '0';
			}

			if (attachment_msg_input) {
				attachment_msg_input.style.margin = '0 30px';
			}

			if (attachment_camera) {
				attachment_camera.style.minWidth = '0';
			}
		}).observe(document, {
			childList: true,
			subtree: true
		});
	},

	fix_chat_window: () => {
		if (wtm.observers.hasOwnProperty('fix_chat_window'))
			return;

		const width = document.getElementsByTagName('body')[0].offsetWidth;
		wtm.observers['fix_chat_window'] = new MutationObserver(() => {
			let main_chat = _('div#main');
			let logout_popup = _('div#app > div > span:nth-of-type(2) > div > div > div > div > div');

			if (main_chat) {
				main_chat.style.width = width + 'px';
			}

			if (logout_popup) {
				logout_popup.style.marginRight = 'auto';
				logout_popup.style.width = width + 'px';
			}
		}).observe(document, {
			childList: true,
			subtree: true
		});
	},

	fix_contact_name: async () => {
		wtm.registered_contacts = await getContacts();
		if(!wtm.registered_contacts)
			return;

		// Dicionario com numeros e seus respectivos nomes
		const contactDict = {};
		wtm.registered_contacts.forEach(contact => {
			contactDict[contact.number] = contact.contact
		});

		// Arruma o nome na chat-list
		const conversationList = _('#pane-side > div:nth-child(3) > div > div');

		if(!conversationList.childNodes)
			return;

		conversationList.childNodes.forEach(conversation => {
			const contact = conversation.querySelector('div > div > div > div > div > div > span > span');

			const contactName = contact.innerHTML.replace(/[^a-zA-Z0-9]/g, '');

			if(/^[0-9]+$/.test(contactName)) {
				const contactNumber = Number(contactName.replace(/[^0-9]/g, ''));
				if(contactDict[contactNumber]) {
					contact.innerHTML = contactDict[contactNumber];
				}
			}
		});

		const replaceNumberToNameInElement = (contactElement, beforeText = '', afterText = '') => {
			if(contactElement) {
				const contactNumber = contactElement.innerHTML.replace(/[^0-9]/g, '');

				if(contactDict[contactNumber]) {
					contactElement.innerHTML = `${beforeText} ${contactDict[contactNumber]} ${afterText}`.trim();
				}
			}
		}
		
		// Arruma o nome na conversa principal
		if (wtm.observers.hasOwnProperty('fix_contact_name')) 
			return;

		wtm.observers["fix_contact_name"] = new MutationObserver(() => {
			const contactConversationElement = _('#main > header > div > div > div > span');
			const contactInfoElement = _('#app > div > div > div > span > div > span > div > div > section > div > div > h2 > span');
			
			replaceNumberToNameInElement(contactConversationElement);
			replaceNumberToNameInElement(contactInfoElement);
		}).observe(document, {
			childList: true,
			subtree: true
		});	
	},

	send_notification: (content) => {
		console.log("Notification:");
		console.log(content);
		WtmPreferences.showNotification(content);
	}, 
	create_dom_watchers: () => {
		// if you click on a chat, show the chat pane.
		var chatlist = _('#pane-side div[role=grid]');
		// new chat button span
		var chatbutton = _('span[data-testid="chat"]');
		// archived chats button
		var archivedBtn = _('#pane-side > button');

		// if you click on new chat, show the contact pane, and then scroll to the contact chat pane
		chatbutton.addEventListener('click', () => {
			// i had to put a timeout in order to save contact_list div value.
			setTimeout(() => {
				var contact_list = _('div[data-testid="contact-list-key"]');
				contact_list.addEventListener('click', () => { wtm.myscroll = true; _('#app').scrollBy(2000,0); });
				});
			}, 500);

		archivedBtn.addEventListener('click', () => {
			setTimeout(() => {
				var archivedChatlist = _('#app > div > div:nth-child(6) > div:nth-child(2) > div > span > div > span > div > div:nth-child(2) > div > div:nth-child(2) > div');
				archivedChatlist.addEventListener('click', () => { wtm.myscroll = true; _('#app').scrollBy(2000,0); });
			});
		}, 500);
		

		var tmp = _('div#side');
		if (!chatlist || !tmp || !tmp.parentNode.nextSibling)
			return false;
			
		wtm.observedNode = tmp.parentNode.nextSibling;
		
		// First we must monitor the clicks on the chat to make sure the scrolling is correct.
		chatlist.addEventListener('mousedown', () => { wtm.myscroll = true; _('#app').scrollBy(2000,0); });
		// Now we must monitor the creation of 'footer div[contenteditable=true]', which is the editbox.
		new MutationObserver(wtm.dom_changed).observe(wtm.observedNode, { childList: true, subtree: true});
		new MutationObserver(wtm.chat_changed).observe(chatlist,{attributes: true, childList: true, subtree: true} )

		// now we avoid unwanted scroll commands.
		var app = _('div#app');
		app.addEventListener('scroll', () => {
			if (wtm.myscroll)
				wtm.scrollx = app.scrollLeft;
			else
				_('div#app').scrollLeft = wtm.scrollx;
			wtm.myscroll = false;

		});
	},

	dom_changed: function(_eventList, observer) {
		
		var edit = wtm.observedNode.querySelector('footer div[contenteditable=true]')
		if (edit && !edit.getAttribute('data-wtm')) {
			edit.addEventListener('click', () => {
				wtm.allow_focus = true;
				console.log('Open Keyboard');
			});
			edit.addEventListener('focus', () => {
				if (!wtm.allow_focus)
					edit.blur();
				wtm.allow_focus = false;
				console.log('Focused on keyboard');
			});
			edit.addEventListener('blur', () => {
				console.log('Left the keyboard');
			});
			edit.setAttribute('data-wtm', 1);
		}

		var hdr = wtm.observedNode.querySelector('header');
		if (hdr) {
			if (hdr.firstChild.id != 'wtm-back') {
				var button = document.createElement('div');
				button.id = 'wtm-back';
				// hdr.style.cssText = 'padding-left: 70px;'
				var button_html = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M19.1 17.2l-5.3-5.3 5.3-5.3-1.8-1.8-5.3 5.4-5.3-5.3-1.8 1.7 5.3 5.3-5.3 5.3L6.7 19l5.3-5.3 5.3 5.3 1.8-1.8z"></path></svg>';
				button.innerHTML = button_html;
				button.style.cssText = 'padding-right: 20px; cursor: pointer';
				button.onclick = function() { wtm.myscroll = true; _('#app').scrollBy(-2000,0); }
				hdr.insertBefore(button, hdr.firstChild);
			}
		}

		observer.takeRecords();
	},
	chat_changed: function(_eventList, observer){
			var notification_alert = _('span[aria-label*="unread message"]');
			if (notification_alert){
				// For the first Message:
				var message = document.querySelector('span[aria-label*="unread message"]').parentElement.parentElement.parentElement.parentElement.innerText.slice(0,-1);
				wtm.send_notification(message);
				// For new Messages:
				var observer = new MutationObserver(() => {
					var message = document.querySelector('span[aria-label*="unread message"]').parentElement.parentElement.parentElement.parentElement.innerText.slice(0,-1);
					wtm.send_notification(message);
					});
				observer.observe(notification_alert, { attributes: true, childList: true });
			}
	},
	ontimer: () => {
		if (!wtm.observers.hasOwnProperty('qr_code_panel')) {
			wtm.observers["qr_code_panel"] = new MutationObserver(() => {
				let qr_code_panel = _("#app > div:nth-child(1) > div > div:nth-child(2) > div:nth-child(1) > div > div:nth-child(2) > div > span > button");

				if (qr_code_panel) {
					// simulates the click and generates a new qr code
					console.log('qr code autogenerate');
					qr_code_panel.click();
				}
			}).observe(document, {
				childList: true,
				subtree: true
			});
		}

		var l = wtm.check_for_landing();
		if (l != 'unknown') {
			if (l == 'BARCODE')
				wtm.open_wtm_login('login');
			else
				wtm.close_wtm_panel();
		}

		else if ((wtm.timercount ++ % 5) == 0) {
			wtm.close_wtm_panel();

			if (wtm.check_for_disconnection()) {
				var now = Date.now();
				if (wtm.last_disconnect + wtm.disconnect_min_retry > now)
					return;
				wtm.last_disconnect = now;

				// connect and "bump"
				let data = new FormData;
				data.append('vd_number', config.params.get('phone_number'));
				fetch(`${config.session.base_url}?cmd=reconnect`, { method: 'POST', body: data });
			}

			if (!wtm.app_changes_done) {
				if (!config.session.base_url)
					wtm.getinstance2(config.params.get('phone_number'));
				wtm.adjust_app();
			}
		}
	},
	init: (doc) => {
		wtm.document = doc;
		wtm.ontimer();
		setInterval(wtm.ontimer, 1000);
	}
}

wtm.init(document);

module.exports = wtm;